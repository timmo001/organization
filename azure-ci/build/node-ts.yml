parameters:
  artifactName: "api"
  artifactPath: "$(Pipeline.Workspace)/api/lib"
  jobName: "Api"
  versionNode: "13.x"
  workingDirectory: "$(Pipeline.Workspace)/api"
  yarnCachePath: "$(Pipeline.Workspace)/.yarn"

jobs:
  - job: "Build_${{ parameters.jobName }}"
    displayName: "${{ parameters.jobName }}"
    steps:
      - task: Cache@2
        inputs:
          key: 'yarn | "$(Agent.OS)" | yarn.lock'
          path: ${{ parameters.yarnCachePath }}
          restoreKeys: |
            yarn | "$(Agent.OS)"
            yarn
        displayName: "Cache Yarn Packages"
      - task: NodeTool@0
        inputs:
          versionSpec: ${{ parameters.versionNode }}
        displayName: "Install Node.js"
      - script: |
          node --version
          yarn --version
          yarn install  --pure-lockfile --cache-folder ${{ parameters.yarnCachePath }}
        workingDirectory: "${{ parameters.workingDirectory }}"  
        displayName: "Install"
      - script: |
          yarn run compile
        displayName: "Compile"
      - task: PublishBuildArtifacts@1
        inputs:
          ArtifactName: "${{ parameters.artifactName }}"
          PathtoPublish: "${{ parameters.artifactPath }}"
          publishLocation: "Container"
        displayName: "Publish"
